function declareJSBehaviour(qr_on){declareHash();declareHTTPModule();declareWAYFButton();if(qr_on){declareLoginQRFunctions();}
declareFormBehaviour();declarePlatformChanges();}
function declareNotesVisibility(){if($('.ui-state-error').length<1){$('.notes_texts').show();}}
function declareFormBehaviour(){$("#formulario1").submit(function(){$("#formulario1").find("input:submit").prop('disabled',true);setTimeout(function(){$("#formulario1").find("input:submit").prop('disabled',false);},5000);return true;});}
function declarePlatformChanges(){if((navigator.platform.indexOf('iPhone')!=-1)||(navigator.platform.indexOf('iPod')!=-1)||(navigator.platform.indexOf('iPad')!=-1)){$('.text-field').css('height','17px');}}
function sendAuthn(name,value,formID){try{var oForm=document.forms[formID];var found=$(oForm).find("#name");if(found.length==0){$(oForm).append("<input type='hidden' name='"+name+"' value='"+value+"'/>");}else{found[0].val(value);}
oForm.submit();}catch(e){alert('Error....\n'+e.message);}}
function declareVirtualKeyboard(configured){if(configured===1){$('#edit-pass').keyboard({restrictInput:true,layout:'spanish-qwerty',language:$("#adAS_i18n_theme").val(),alwaysOpen:false,openOn:null,position:{of:null,my:'center top',at:'center bottom',},maxLength:false,visible:function(e,keyboard,el){$('#edit-pass').prop('disabled',true);},beforeClose:function(e,keyboard,el,accepted){$('#edit-pass').prop('disabled',false);}}).addTyping();$("#password-vkeyboard-opener").click(function(){$('#edit-pass').getkeyboard().reveal();});}}
function declareHTTPModule(){$('a.http_authn_module').click(function(){if($(this).attr("disabled")!="disabled"){$('#panelhttp').hide();$('#externalauth').load(path+"authn/httpauth/js-httpauth.php",function(response,status,xhr){checkError(response,status,xhr,"error_httpauth");});}});}
function checkError(response,status,xhr,error_id){if(xhr.status>=300){var error_msg='<div class="ui-state-error ui-corner-all error_msg">';error_msg+='<p><span class="ui-icon ui-icon-alert icono-alerta"></span>';error_msg+='<span id="text_span_error"><strong id="'+error_id+'">'+textos[$("#langs .highlight_lang").attr("id")][error_id]+'</strong></span>';error_msg+='</p></div>';if($(".bloque .error_msg").length==0){$(".bloque").prepend(error_msg);}else{$(".bloque .error_msg #text_span_error").html('<strong id="'+error_id+'">'+textos[$("#langs .highlight_lang").attr("id")][error_id]+'</strong>');}}}
function declareX509Module(){$("#x509_module").click(function(e){e.preventDefault();if($(this).attr("disabled")!="disabled"){$("#confirm_tls_dialog").dialog({resizable:false,height:'auto',modal:false,closeText:'hide',buttons:{confirm_txt:function(){$(this).dialog("close");window.location=$("#x509_module").attr('href');$('#background_wayf').hide();},confirm_ko_txt:function(){$(this).dialog("close");$('#background_wayf').hide();}},open:function(event,ui){var buttons=$(this).parent().find(".ui-button-text");$(buttons[0]).html("<span id='submit_confirm'>"+$(buttons[0]).html()+"</span>");$(buttons[1]).html("<span id='submit_ko'>"+$(buttons[1]).html()+"</span>");var theme_lang=$("#adAS_i18n_theme").val();if(theme_lang!=undefined){translate_to(theme_lang);}
$('#background_wayf').height($(document).height()*1.20).show();}});var dialog=$("#confirm_tls_dialog").parent();dialog.css('font','14px arial,helvetica,verdana,sans-serif');dialog.find("p").css('padding','20px');dialog.find("button").css('background',button_light).css('color','#fff').css('font','14px arial,helvetica,verdana,sans-serif');dialog.find(".ui-dialog-titlebar").css('background',button_light).css('color','#fff');dialog.find(".ui-dialog-titlebar-close").hide();}});$('.return_to_userpassword').click(function(event){event.preventDefault();$('#panelhttp').hide();$('#userpass').show();});}
function declareWAYFButton(){$("#wayf_button").click(function(){$('#background_wayf').show();$('#wayfotherlogin').fadeIn('slow',function(){$('#background_wayf').height($(document).height()*1.20);});});$("#wayf_button_close2").click(function(){$('#wayfotherlogin').fadeOut();$('#background_wayf').hide();});}
function declareHash(){var url_hash=window.location.hash;if(url_hash.length!==0){processAction(url_hash);processModules(url_hash);}}
function processAction(url_hash){var acti=$("#formulario1").attr('action');$("#formulario1").attr('action',acti+url_hash);}
function processModules(url_hash){$("a.own-button").each(function(){var acti_own=$(this).attr('href');$(this).attr('href',acti_own+url_hash);});}
function pollLoginQR(){t=setTimeout(function(){$.ajax({url:path+'authn/qr/qr_login.php?show_qr=0'+"&user_qr="+$("#edit-name").val(),dataType:"json",success:function(data){if(data.status!==1){timeout=timeout-ms_interval / 1000;if(timeout<0){$('#qr_login').fadeOut();$('#background_wayf').hide();clearTimeout(t);timeout=timeout_base;var error_msg='<div class="ui-state-error ui-corner-all error_msg">';error_msg+='<p><span class="ui-icon ui-icon-alert icono-alerta"></span>';error_msg+='<span id="text_span_error"><strong id="authr_qr_login_exipred_ttl">'+getText('authr_qr_login_exipred_ttl')+'</strong></span>';error_msg+='</p></div>';if($(".bloque .error_msg").length===0){$(".bloque").prepend(error_msg);}else{$(".bloque .error_msg").remove();$(".bloque").prepend(error_msg);}}else{pollLoginQR();}}else{var action=$('#formulario1').attr('action');var adas_mode='<input name="adAS_mode" value="authn" />';var qr_mode='<input name="adAS_authn_module" value="qr_module" />';var username='<input name="adAS_username_qr" value="'+$("#edit-name").val()+'" />';$('<form action="'+action+'" method=\'post\'>'+adas_mode+qr_mode+username+'</form>').appendTo('body').submit();}}});},ms_interval);}
function getText(key){var langnow=$("#langs .highlight_lang").attr("id");if(typeof textos[langnow]!=='undefined'&&typeof textos[langnow][key]!=='undefined'){return textos[langnow][key];}}
function declareLoginQRFunctions(){$("#qr_button").click(function(){if($("#edit-name").val()){var d=new Date();var url_img_base=path+"authn/qr/qr_login.php?show_qr=1";$("#qr_img_login").attr('src',url_img_base+"&user_qr="+$("#edit-name").val()+"&date="+d.getTime());$('#background_wayf').show();$('#qr_login').fadeIn('slow',function(){$('#background_wayf').height($(document).height()*1.20);});pollLoginQR();}else{showAlertMessage();}});$("#qr_button_close2").click(function(){clearTimeout(t);timeout=timeout_base;$('#qr_login').fadeOut();$('#background_wayf').hide();});}
function showAlertMessage(){var confirm_txt=getText('submit_confirm');$("#alert_message_dialog").dialog({resizable:false,height:'auto',modal:true,closeText:'hide',buttons:{confirm_txt:function(){$(this).dialog("close");$('#background_wayf').hide();},},open:function(event,ui){var buttons=$(this).parent().find(".ui-button-text");$(buttons[0]).html("<span id='submit_confirm'>"+$(buttons[0]).html()+"</span>");var theme_lang=$("#adAS_i18n_theme").val();if(theme_lang!=undefined){translate_to(theme_lang);}
$('#background_wayf').height($(document).height()*1.20).show();}});var dialog=$("#alert_message_dialog").parent();dialog.css('font','14px arial,helvetica,verdana,sans-serif');dialog.find("p").css('padding','20px');dialog.find("button").css('background',button_light).css('color','#fff').css('font','14px arial,helvetica,verdana,sans-serif');dialog.find(".ui-dialog-titlebar").css('background',button_light).css('color','#fff');dialog.find(".ui-dialog-titlebar-close").hide();}